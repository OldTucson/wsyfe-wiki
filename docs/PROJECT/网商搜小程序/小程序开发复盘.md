---
title: å°ç¨‹åºå¼€å‘å¤ç›˜
---

## ğŸ“ éœ€æ±‚åœºæ™¯

ç½‘å•†æœå°ç¨‹åºç‰ˆåº”ç”¨å¼€å‘ï¼Œæ¶‰åŠåŠŸèƒ½æœ‰è´¦æˆ·ä½“ç³»ã€ç”¨æˆ·ä¸‹å•æµç¨‹ã€è®¢å•å”®åæµç¨‹ç­‰

## â­ æ”¶è·çš„æŠ€å·§

### 1.å¾®ä¿¡ç™»å½•æµç¨‹

> ğŸ“ æµç¨‹å›¾

![æµç¨‹å›¾](/login-er.jpg)

ğŸ”§ å…·ä½“å®ç°

> åŸºæœ¬æ ·å¼

![åŸºæœ¬æ ·å¼](/login-style.jpg)

> ä¸ºæŒ‰é’®ç»‘å®šå¯¹åº”çš„ open-type å’Œ bindgetuserinfo å±æ€§å³å¯ç¼ºçœå¼åœ°ï¼ˆæœ‰æˆæƒåˆ™ä¸å”¤èµ·ï¼‰å”¤èµ·å¾®ä¿¡è·å–ä¿¡æ¯æˆæƒå¼¹æ¡†

```html
<button open-type="getUserInfo" bindgetuserinfo="bindGetUserInfo">
  <view>å¾®ä¿¡ç”¨æˆ·å¿«æ·ç™»å½•</view>
</button>

//å¦‚æœæ˜¯æ‰‹æœºå·ç™»å½•åˆ™éœ€è¦å…ˆç»‘å®šæ‰‹æœºå·
<button open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">
  ç»‘å®šæ‰‹æœº
</button>
```

```js
// ç‚¹å‡»æˆæƒ
  bindGetUserInfo(e) {
    let userInfo = e.detail.userInfo;
    // ç‚¹å‡»åŒæ„æˆæƒ
    if (userInfo) {
      wx.setStorageSync("userInfo", userInfo);
      wx.login({
        success: res => {
          ...//ç™»å½•é€»è¾‘
          //å¦‚æœæ˜¯æ‰‹æœºå·ç™»å½•åˆ™éœ€è¯·æ±‚æœåŠ¡ç«¯åˆ¤æ–­æ˜¯å¦å·²ç»‘å®šæ‰‹æœº
        }
      })
    }
  },
               //æ‰‹æœºå·æˆæƒ
  getPhoneNumber(e) {
    if (!e.detail.encryptedData && !e.detail.iv) {
      return
    }
    let {
      avatarUrl,
      nickName
    } = this.data.userInfo
    wx.login({
      success: res => {
        let {
          code
        } = res

        let obj = {
          code,
          encryptedData: e.detail.encryptedData,
          iv: e.detail.iv,
          nick: nickName,
          cover: avatarUrl
        }
        //ä»æˆæƒä¿¡æ¯ä¸­è·å–æ•°æ®å‘é€ç»™æœåŠ¡ç«¯è¿›è¡Œç»‘å®šæˆ–æ³¨å†Œæ“ä½œ
        XXXXX(obj).then(res => {
					...
          //æˆåŠŸåå°†æœåŠ¡ç«¯è¿”å›çš„tokenåšæœ¬åœ°å­˜å‚¨
          let access_token = res.data.access_token
          wx.setStorageSync("token", access_token);
        })
      }
    })

  },
```

> å°è£…ç™»å½•æ‹¦æˆªå‡½æ•°

```js
const isLogin = (shouldJump = false) => {
  let token = wx.getStorageSync("token") || "";
  if (!token) {
    if (shouldJump) {
      wx.navigateTo({
        url: "/pages/login/login",
      });
    } else {
      return false;
    }
  }
  return true;
};
```

### 2.å¾®ä¿¡æ”¯ä»˜æµç¨‹

ğŸ”§ å…·ä½“å®ç°

> æ ¹æ®ä¸šåŠ¡åœºæ™¯éœ€è¦ï¼Œé¡¹ç›®ä¸­çš„æ”¯ä»˜å¯è¿›è¡Œè´¦æˆ·ä½™é¢+åŠ å¾®ä¿¡æ”¯ä»˜çš„æ··åˆæ”¯ä»˜æ–¹å¼ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ï¼Œåªå¯¹å¾®ä¿¡æ”¯ä»˜éƒ¨åˆ†è¿›è¡Œåˆ†æ

```js
WeiXinPay() {
    //å¾®ä¿¡æ”¯ä»˜é€»è¾‘/å¾®ä¿¡é¢å¤–æ”¯ä»˜
    let that = this
    wx.login({
      success(res) {
        if (res.code) {

          let {
            order_id,
          } = that.data
          let obj = {
            order_id: JSON.stringify(order_id),
          }
          //å‘æœåŠ¡ç«¯å‘é€è®¢å•IDæ¢å–ç”¨äºå¾®ä¿¡æ”¯ä»˜çš„ä¿¡æ¯
          reqGetWeixinPayInfo(obj).then(res => {
            if (res.data.code == 200) {
              let {
                nonceStr,
                signType,
                timeStamp,
                sign,
                trade_sn
              } = res.data.data
              let package1 = res.data.data.package //ç›´æ¥ç”¨packageè§£æ„ä¼šæŠ¥å…³é”®å­—çš„é”™è¯¯ æ•…è¿™é‡Œä½¿ç”¨è¿™ç§æ†¨æ†¨å†™æ³•
              wx.requestPayment({
                // æ—¶é—´æˆ³
                timeStamp,
                // éšæœºå­—ç¬¦ä¸²
                nonceStr,
                // ç»Ÿä¸€ä¸‹å•æ¥å£è¿”å›çš„ prepay_id å‚æ•°å€¼
                package: package1,
                // ç­¾åç±»å‹
                signType,
                // ç­¾å
                paySign: sign,
                // è°ƒç”¨æˆåŠŸå›è°ƒ
                success() {
                  //æ”¯ä»˜æˆåŠŸåçš„é€»è¾‘
                  //å¾®ä¿¡APIæä¾›çš„æ”¯ä»˜æˆåŠŸå›è°ƒå¹¶ä¸èƒ½ä½œä¸ºçœŸæ­£æ”¯ä»˜æˆåŠŸçš„åˆ¤æ–­
                  //æ­£ç¡®çš„åšæ³•æ˜¯åœ¨å›è°ƒä¸­å‘æœåŠ¡ç«¯è¯·æ±‚æ”¯ä»˜çŠ¶æ€
                  that.getPayStatus({trade_sn})
                },
                // å¤±è´¥å›è°ƒ
                fail() {
                  that.getPayStatus({trade_sn})
                },
                // æ¥å£è°ƒç”¨ç»“æŸå›è°ƒ
                complete() {}
              })
            } else {
              wx.showToast({
                title: res.data.message,
                icon: 'none'
              })
            }
          })

        }
      }
    })
  },
```

### 3.å°ç¨‹åºå†…çš„æ»‘åŠ¨åˆ é™¤åŠŸèƒ½

ğŸ”§ å…·ä½“å®ç°

> æ ¹æ®å®é™…åº”ç”¨åœºæ™¯å°è£…ç”¨äºæ»‘åŠ¨æ‹–æ‹½çš„ç±»

```js
class TouchesNormal {
  constructor() {}

  _getIndex(e) {
    // è·å–æ»‘åŠ¨åˆ—è¡¨çš„ä¸‹æ ‡å€¼
    return e.currentTarget.dataset.index;
  }

  _getMoveX(e, startX) {
    // è·å–æ»‘åŠ¨è¿‡ç¨‹ä¸­æ»‘åŠ¨çš„è·ç¦»
    return this.getClientX(e) - startX;
  }

  _getEndX(e, startX) {
    // è·å–æ»‘åŠ¨ç»“æŸæ»‘åŠ¨çš„è·ç¦»
    let touch = e.changedTouches;
    if (touch.length === 1) {
      return touch[0].clientX - startX;
    }
  }

  _resetData(dataList) {
    // é‡ç½®æ•°æ®ï¼Œ æŠŠæ‰€æœ‰çš„åˆ—è¡¨ left ç½®ä¸º 0
    for (let i in dataList) {
      dataList[i].left = 0;
    }
    return dataList;
  }
  getClientX(e) {
    // è·å–æ»‘åŠ¨çš„æ¨ªåæ ‡
    let touch = e.touches;
    if (touch.length === 1) {
      return touch[0].clientX;
    }
  }

  touchM(e, dataList, startX) {
    // touchmove è¿‡ç¨‹ä¸­æ›´æ–°åˆ—è¡¨æ•°æ®
    let list = this._resetData(dataList);
    let { goodsindex } = e.currentTarget.dataset;
    list[goodsindex].left = this._getMoveX(e, startX);

    return list;
  }

  touchE(e, dataList, startX, width) {
    // touchend æ›´æ–°åˆ—è¡¨æ•°æ®
    let list = this._resetData(dataList);
    let disX = this._getEndX(e, startX);
    let left = 0;

    if (disX < 0) {
      // åˆ¤æ–­æ»‘åŠ¨æ–¹å‘ï¼Œ ï¼ˆå‘å·¦æ»‘åŠ¨ï¼‰
      // æ»‘åŠ¨çš„è·ç¦»å¤§äºåˆ é™¤å®½åº¦çš„ä¸€åŠå°±æ˜¾ç¤ºæ“ä½œåˆ—è¡¨ å¦åˆ™ä¸æ˜¾ç¤º
      Math.abs(disX) > width / 2 ? (left = -width) : (left = 0);
    } else {
      // å‘å³æ»‘åŠ¨å¤ä½
      left = 0;
    }
    let { goodsindex } = e.currentTarget.dataset;
    list[goodsindex].left = left;
    return list;
  }

  deleteItem(e, dataList) {
    // åˆ é™¤åŠŸèƒ½
    dataList.splice(this._getIndex(e), 1);
    return dataList;
  }
}

export default TouchesNormal;
```

> å°†å…¶æŒ‚è½½æŒ‚è½½è‡³ app.js ä¸­

```js
//app.js
...
import TouchesNormal from './utils/TouchesNormal.js'
App({
  onLaunch: function (params) {
    ...
  },
	...
  globalData: {
    ...
  },
  TouchesNormal: new TouchesNormal(),
})
```

> åœ¨é¡µé¢ä¸­å¼•ç”¨

```js

const app = getApp()

Page({

  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {
    cardList: [], //é“¶è¡Œå¡åˆ—è¡¨
  },

  //è§£ç»‘
  unbindAccount(e) {
    ...//ç›¸å…³æ“ä½œé€»è¾‘
  },

  touchS: function (e) { // touchstart
    let startX = app.TouchesNormal.getClientX(e)
    startX && this.setData({
      startX
    })
  },
  touchM: function (e) { // touchmove
    ...
    let cardList = app.TouchesNormal.touchM(e, this.data.cardList, this.data.startX)
      cardList && this.setData({
        cardList
      })
  },
  touchE: function (e) { // touchend
    ...
    let width = 80 // å®šä¹‰æ“ä½œåˆ—è¡¨å®½åº¦ æ­¤å¤„å®½åº¦è¦ä¸é¡µé¢ä¸­æ»‘åŠ¨æ“ä½œé¡¹å®½åº¦ä¸€è‡´
    let cardList = app.TouchesNormal.touchE(e, this.data.cardList, this.data.startX, width)
    cardList && this.setData({
      cardList
    })

  }

})
```

é¡µé¢å¸ƒå±€ï¼š

æœ€å¤–å±‚çˆ¶çº§å®¹å™¨ä½¿ç”¨ position:relative

å±•ç¤ºå®¹å™¨å’Œæ“ä½œé¡¹å®¹å™¨éƒ½æ˜¯ç”¨ç»å¯¹å®šä½ position:absolute å¹¶ä¸”å®½åº¦éƒ½ä¸çˆ¶å®¹å™¨ä¸€è‡´

æœ€åå°†å±•ç¤ºå®¹å™¨çš„ z-index è®¾ç½®å¾—æ¯”æ“ä½œé¡¹å®¹å™¨çš„æ›´å¤§å³å¯

> åŠ¨æ€åœ°ä¸ºå±•ç¤ºå®¹å™¨ä¿®æ”¹ç»å¯¹å®šä½çš„ left å±æ€§å³å¯å®ç°æœ€ç»ˆæ•ˆæœ

```html
<view
  wx:for="{{cardList}}"
  wx:for-item="cardItem"
  wx:for-index="cardIndex"
  wx:key="{{cardIndex}}"
>
  <view
    class="list-item {{'list-item' + cardIndex%3}}"
    data-goodsindex="{{cardIndex}}"
    bindtouchstart="touchS"
    bindtouchmove="touchM"
    bindtouchend="touchE"
    style="left:{{cardItem.left + 'rpx'}}"
  >
    ...//å±•ç¤ºå®¹å™¨
  </view>
  <view class="option-item">
    ...//æ“ä½œé¡¹
    <view catchtap="unbindAccount" data-id="{{cardItem.id}}">åˆ é™¤</view>
  </view>
</view>
```

### 4.å°ç¨‹åºå†…è§£æ HTML

ğŸ“ å°ç¨‹åºé¡¹ç›®ä¸­æ¶‰åŠåˆ°ç”¨æˆ·åè®®ç­‰ä¸šåŠ¡é€šå¸¸æ˜¯ä½¿ç”¨å·²æœ‰çš„é€šç”¨ HTML æ¨¡æ¿ï¼Œä½†åœ¨å°ç¨‹åºä¸­ä½¿ç”¨ HTML éœ€è¦åšä¸€æ­¥é¢å¤–çš„å¤„ç†å·¥ä½œ

ğŸ”§ å…·ä½“å®ç°

[ä¸‹è½½ wxParse.js æ–‡ä»¶å¹¶å¼•å…¥é¡¹ç›®ä¸­](https://github.com/icindy/wxParse)

> åœ¨éœ€è¦è§£æ HTML çš„é¡µé¢ä¸­å¼•ç”¨

```js
// pages/schoolDetail/schoolDetail.js
var WxParse = require("../../../wxParse/wxParse.js");

const app = getApp();
Page({
  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {
    article: "",
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function(options) {
    //å¤åˆ¶HTMLå¹¶è¿›è¡Œè§£æ
    let article = `<div id="u8" class="text" style="visibility: visible;">...</div>`;
    WxParse.wxParse("article", "html", article, this, 0);
    // this.setData({article})
  },
});
```

> åœ¨ app.wxss æˆ–åœ¨å¯¹åº”çš„æ ·å¼é“¾è¡¨ä¸­å¼•å…¥ wxParse.wxss

```css
@import "../../../wxParse/wxParse.wxss";
```

```html
<header title="éšç§åè®®" backBull="true"></header>
<import src="../../../wxParse/wxParse.wxml" />
<view class="protocol-wrap">
  <view class="title">
    éšç§æ”¿ç­–
  </view>
  <view class="line">
    <template is="wxParse" data="{{wxParseData:article.nodes}}" />
  </view>
</view>
```

### 5.å°ç¨‹åºè·³è½¬å…¬ä¼—å·æ–‡ç« 

ğŸ”§ å…·ä½“å®ç°

åªéœ€å•ç‹¬æ–°å»ºä¸€ä¸ª page åœ¨å…¶ä¸­æ·»åŠ  webview å®¹å™¨å³å¯

> SRC é“¾æ¥ä¸ºè¦è·³è½¬çš„å…¬ä¼—å·æ–‡ç« é“¾æ¥

```html
<web-view src="https://mp.weixin.qq.com/s/bK_0v-GQ1b0GlUx1uQUtlg"></web-view>
```

## ğŸ’¡ é‡åˆ°çš„é—®é¢˜

1. IOS ç¯å¢ƒä¸‹è°ƒç”¨ wx.navigateBack()æ—¶ä¼šå‡ºç°ç›´æ¥é€€å‡ºå°ç¨‹åºçš„æƒ…å†µ

â›” é—®é¢˜åŸå› ï¼šæ’é™¤å°ç¨‹åºå †æ ˆé™åˆ¶é—®é¢˜åŠç”Ÿå‘½å‘¨æœŸç›¸å…³å…¼å®¹æ€§é—®é¢˜ï¼Œæš‚æœªå‘ç°é—®é¢˜åŸå› 

âœ… è§£å†³æ–¹æ¡ˆï¼šç‰ºç‰²äº¤äº’é€‰æ‹© wx.redirectTo()è¿›è¡Œé¡µé¢è·³è½¬ä»¥å…¼å®¹æ­¤ç§åœºæ™¯

2. IOS ç¯å¢ƒä¸‹ iPhoneX åŠç›¸ä¼¼æœºå‹åº•éƒ¨æ“ä½œæ ä¼šå‡ºç°ç©ºç™½é—´éš™

â›” é—®é¢˜åŸå› ï¼šæœªé’ˆå¯¹éƒ¨åˆ† IOS æœºå‹åšåº•éƒ¨å®‰å…¨è·ç¦»é€‚é…

âœ… è§£å†³æ–¹æ¡ˆï¼šä»¥ä¸€ä¸ªç”¨ç»å¯¹å®šä½æ ·å¼çš„åº•éƒ¨æ“ä½œæŒ‰é’®ä¸ºä¾‹

```css
 {
  position: fixed;
  right: 0;
  bottom: 90rpx;
  ---->è¿™ä¸‰ç§æƒ…å†µéƒ½å¿…é¡»æŒ‰ç…§é¡ºåºå†™,å¦åˆ™ä¸ç”Ÿæ•ˆbottom: calc(
    constant(safe-area-inset-bottom) + 90rpx
  );
  ---->padding/marginç­‰æ ·å¼åŒç†bottom: calc(
    env(safe-area-inset-bottom) + 90rpx
  );
  ---->left: 0;
}
```

3. ä¸åŒæœºå‹æƒ…å†µä¸‹é¡µé¢é¡¶éƒ¨çš„æ“ä½œæ ä¼šå‡ºç°é—´éš™æˆ–é«˜åº¦ä¸å¯¹çš„æƒ…å†µ

â›” é—®é¢˜åŸå› ï¼šå„æœºå‹çŠ¶æ€æ é«˜åº¦ä¸åŒæœªé€‚é…

âœ… è§£å†³æ–¹æ¡ˆï¼šåŠ¨æ€è·å–è®¾å¤‡çŠ¶æ€æ é«˜åº¦å¹¶ä¸ºæ“ä½œæ åŠ¨æ€è®¾ç½®

```js
//app.js
wx.getSystemInfo({
  success: res => {
    this.globalData.statusBarHeight = res.statusBarHeight;
  },
});
...
globalData: {
    statusBarHeight: null,
}
```

```html
//åŠ¨æ€è®¾ç½®æ“ä½œæ é«˜åº¦
<header
  title="æˆ‘çš„è®¢å•"
  backBull="true"
  isFromTransfer="{{isFromTransfer}}"
></header>
<view
  class="option-block"
  style="position:fixed;left:0;top:{{optionTop}}rpx;"
></view>
```

```js
...
const app = getApp()
data: {
    optionTop: app.globalData.statusBarHeight
 }
 ...
```
